#Version 28/01/2021

#General configuration
# coding: utf8

# path to directory to save matrices and results.
Data_dir = './'

[modelconfig]

    #On bench or numerical simulation
    onbench=False

    #Image
    dim_im   = 400          # image size (in pixels)
    dim_sampl= 150           #Taille r√©echantillonage
    
    #Lambda over D after Lyot stop
    wavelength = 783.25e-9 # wavelength for image (in meters)
    science_sampling = 7.8 #sampling in the science focal plane (lambda/Lyot diameter) in pixel 
    
    #pupil and Lyot stop
    diam_pup_in_m = 8.23e-3 # pupil diameter (in meters)
    diam_lyot_in_m  = 7.9e-3  # lyot diameter (in meters)
    # instrument pupil ignored if ""
    filename_instr_pup = "" #"instru_pup.fits" 
    # instrument Lyot stop ignored if ""
    filename_instr_lyot = "" #"instru_lyot.fits"

[DMconfig]

    #############
    ## DM 1
    #############
    
    #DM model
    DM1_pitch=0.3e-3 #in meter, pitch of the DM (distance between actuators)
    DM1_creating_pushact=True
    #If creating_pushact is True, must defined x309 and y309 or filename_actu309

    DM1_z_position = 26.9e-2# m from the pupil in a collimated beam
    #Center of actuator DM1_ActuN (found by SCC on master for the moment)
    DM1_ActuN=309
    DM1_x_ActuN=10.68#210.68 #63.5+200-54-0.5
    DM1_y_ActuN=12.15#212.15 #68.5+200-54
    #Estimated phase when poking actuator #309
    # If filename_actu309 is not "" then automatic calculation of xy309 
    DM1_filename_actuN = ""#Phase_estim_Act309_v20200107.fits"
    # filename of the grid of actuator positions
    DM1_filename_grid_actu="DM3_Grid_actu_Pixel156mic.fits"
    #filename of the actuator influence function
    DM1_filename_actu_infl_fct="Actu_DM32_field=6x6pitch_pitch=22pix.fits"

    #############
    ## DM 3
    #############
    #DM model
    DM3_pitch=0.3e-3 #in meter, pitch of the DM (distance between actuators)
    DM3_creating_pushact=True
    #If creating_pushact is True, must defined x309 and y309 or filename_actu309

    #Center of actuator 309 (found by SCC on master for the moment)
    DM3_ActuN=309
    DM3_x_ActuN=10.68#210.68 #63.5+200-54-0.5
    DM3_y_ActuN=12.15#212.15 #68.5+200-54
    #Estimated phase when poking actuator #309
    # If filename_actu309 is not "" then automatic calculation of xy309 
    DM3_filename_actuN = ""#Phase_estim_Act309_v20200107.fits"
    # filename of the grid of actuator positions
    DM3_filename_grid_actu="DM3_Grid_actu_Pixel156mic.fits"
    #filename of the actuator influence function
    DM3_filename_actu_infl_fct="Actu_DM32_field=6x6pitch_pitch=22pix.fits"

[Coronaconfig]

    corona_type ='fqpm' #Can be fqpm or knife
    coro_position = 'left' #If knife, can be left, right, top, bottom
    knife_coro_offset = 1.2 #offset of the   knife in lambda/pupil diameter
    err_fqpm = 0 # phase error on the pi phase-shift for FQPM
    prop_lyot2science ='fft' #Can be mft or fft

[PWconfig]
    #PW parameters
    amplitudePW = 34
    #posprobes = 309,495,659
    posprobes = 466,498
    #posprobes = 466,465
    #cut = 1e6
    cut = 5e4
    # cut=5e5 #Knife

[EFCconfig]
    #EFC parameters
    # The lowest the more actuators are considered
    # ratio of energy of the influence function inside the pupil wrt to energy of the influence function
    MinimumSurfaceRatioInThePupil = 0.1
    DHshape = "circle"
    #if square
    choosepix = 8,35,-35,35#8,35,-35,35
    #if circle
    circ_rad= 8,35  #inner and outer radii of the circle DH
    circ_side = "Right" #"Full", "Left", "Right", "Top", "Bottom" to select one side of the fov
    circ_offset = 0 # if circ_side != "Full", remove pixels closer than offset  
    circ_angle = 15 # degrees

    DM3_otherbasis=False#If true, uses the basis saved by init_SCC in IDL
    Nbmodes =330
    amplitudeEFC = 17
    regularization='tikhonov'
    
    
[SIMUconfig]
    #Simulation close loop parameters 
    Name_Experiment = 'First_Simulation'
    set_amplitude_abb=False 
    amplitude_abb='Amplitudebanc_center4pixels'
    set_phase_abb=True
    set_random_phase=True
    phaserms = 20e-9 #in meter
    rhoc_phase = 4.3
    slope_phase = 3
    phase_abb_filename ='phase20rmsfm3'
    photon_noise = False
    nb_photons = 4e10
    correction_algorithm = 'EFC' #EFC for Electric Field Conjugation or EM for Energy Minimization or steepest
    Nbiter_corr=5,5,10
    Nbmode_corr=350,380,400
    gain=0.6
    Linesearch = False
    Linesearchmode = 400,440,480,520,560,600

# Error on the model of the DM
    xerror=0        #x-direction translation in pixel
    yerror=0        #y-direction translation in pixel
    angerror=0      #rotation in degree
    gausserror=0   #influence function size

    estimation='Perfect' # FP WF sensing : 'Perfect' or 'pw'
